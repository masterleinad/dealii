name: tidy

on: [push, pull_request]

concurrency:
  group: ${ {github.event_name }}-${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: ${{github.event_name == 'pull_request'}}

jobs:
  tidy:
    name: tidy
    runs-on: [ubuntu-22.04]
    container:
      image: dealii/dependencies:jammy
      options: --user root --env OMPI_ALLOW_RUN_AS_ROOT=1 --env OMPI_ALLOW_RUN_AS_ROOT_CONFIRM=1

    steps:
    - uses: actions/checkout@v3
    - name: modules
      run: |
        sudo apt-get install -y software-properties-common
        sudo apt-get update
        sudo apt-get install -yq --no-install-recommends \
            clang-12 \
            clang-tidy-12 \
    - name: tidy
      run: |
        mkdir build
        cd build
        export PATH=/usr/lib/llvm-12/share/clang/:$PATH
        ls /usr/lib/llvm-12/share/clang/*
        ls /usr/lib/llvm-12/bin/*
        ../contrib/utilities/run_clang_tidy.sh ..
